<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Learn Japanese Vocabulary - Flashcards & Quiz (multi-file)</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <!-- Swiper -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <div class="container py-4 app-shell">
    <!-- Header -->
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3 app-header">
      <div class="d-flex align-items-center gap-2 header-left">
        <div class="brand-badge">
          <i class="bi bi-journal-bookmark-fill text-primary"></i>
          <span data-i18n="app_title">Learn Japanese Vocabulary</span>
        </div>
        <span class="small text-secondary" data-i18n="header_subtitle">Flashcards + Quiz - Import/Export</span>
      </div>

      <div class="d-flex flex-wrap align-items-center gap-2 header-actions">
        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#dataModal">
          <i class="bi bi-braces"></i> <span data-i18n="btn_import_manage">Import/Manage</span>
        </button>
        <div class="dropdown">
          <button class="btn btn-outline-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-download"></i> <span data-i18n="btn_export">Export</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><button class="dropdown-item" id="btnExportData"><i class="bi bi-file-earmark-code"></i> <span data-i18n="btn_export_data">Export Data (decks/items)</span></button></li>
            <li><button class="dropdown-item" id="btnExportAll"><i class="bi bi-file-earmark-zip"></i> <span data-i18n="btn_export_all">Export Data + Progress</span></button></li>
          </ul>
        </div>
        <button id="btnShuffle" class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-shuffle"></i> <span data-i18n="btn_shuffle">Shuffle</span>
        </button>
        <button id="btnResetProgress" class="btn btn-outline-danger btn-sm">
          <i class="bi bi-arrow-counterclockwise"></i> <span data-i18n="btn_reset_progress">Reset progress</span>
        </button>
        <div class="d-flex align-items-center gap-2 ms-1 lang-wrap">
          <label for="langSelect" class="small text-secondary mb-0" data-i18n="label_language">Language</label>
          <select id="langSelect" class="form-select form-select-sm w-auto">
            <option value="en" data-i18n="lang_en">English</option>
            <option value="vi" data-i18n="lang_vi">Vietnamese</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Top controls -->
    <div class="panel p-3 mb-3">
      <div class="row g-3 align-items-end">
        <div class="col-12 col-lg-4">
          <label class="form-label fw-semibold" data-i18n="label_deck">Deck</label>
          <select id="deckSelect" class="form-select"></select>
          <div class="form-text small-muted">
            <span class="kbd">Space</span> <span data-i18n="helper_deck_shortcuts">to flip - Left/Right arrows to move cards quickly</span>
          </div>
        </div>

        <div class="col-12 col-lg-4">
          <label class="form-label fw-semibold" data-i18n="label_search">Search</label>
          <input id="searchInput" class="form-control" placeholder="Enter JP/Kana/VI/tags to filter..." data-i18n-placeholder="placeholder_search">
        </div>

        <div class="col-12 col-lg-4">
          <div class="d-flex gap-2">
            <div class="flex-grow-1">
              <label class="form-label fw-semibold" data-i18n="label_mode">Display</label>
              <select id="modeSelect" class="form-select">
                <option value="jp_to_vi" data-i18n="mode_jp_to_vi">JP -> VI</option>
                <option value="vi_to_jp" data-i18n="mode_vi_to_jp">VI -> JP</option>
              </select>
            </div>
            <div class="flex-grow-1">
              <label class="form-label fw-semibold" data-i18n="label_quiz">Quiz</label>
              <select id="quizType" class="form-select">
                <option value="mc" data-i18n="quiz_mc">Multiple choice</option>
                <option value="type" data-i18n="quiz_type">Type answer</option>
              </select>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="d-flex flex-wrap gap-2 align-items-center justify-content-between">
            <div class="d-flex flex-wrap gap-2 align-items-center">
              <span class="stat"><i class="bi bi-collection-fill text-primary"></i> <span data-i18n="stat_total">Total</span>: <b id="statTotal">0</b></span>
              <span class="stat"><i class="bi bi-check2-circle text-success"></i> <span data-i18n="stat_known">Known</span>: <b id="statKnown">0</b></span>
              <span class="stat"><i class="bi bi-hourglass-split text-warning"></i> <span data-i18n="stat_learning">Learning</span>: <b id="statLearning">0</b></span>
            </div>

            <div class="d-flex flex-wrap gap-2">
              <div class="form-check form-switch d-flex align-items-center gap-2 me-1">
                <input class="form-check-input" type="checkbox" role="switch" id="autoSpeakToggle">
                <label class="form-check-label small text-secondary" for="autoSpeakToggle" data-i18n="label_auto_speak">Auto speak</label>
              </div>
              <button id="btnFlash" class="btn btn-primary">
                <i class="bi bi-cards"></i> <span data-i18n="btn_flashcards">Flashcards</span>
              </button>
              <button id="btnQuiz" class="btn btn-outline-primary">
                <i class="bi bi-ui-checks"></i> <span data-i18n="btn_quiz">Quiz</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main -->
    <div class="row g-3">
      <!-- Flashcards -->
      <div class="col-12 col-lg-7">
        <div class="panel p-3 h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div>
              <div class="fw-bold fs-5" data-i18n="flashcards_title">Flashcards</div>
              <div class="small-muted" data-i18n="flashcards_hint">Tap the card to flip. Mark as Known / Learning.</div>
            </div>
          </div>

          <div id="flashEmpty" class="alert alert-warning d-none mb-0" data-i18n="flashcards_empty">No data yet. Click Import/Manage to load JSON.</div>

          <div id="flashArea" class="d-none">
            <div class="swiper" id="cardSwiper">
              <div class="swiper-wrapper" id="swiperWrapper"></div>
              <div class="swiper-pagination"></div>
              <div class="swiper-scrollbar"></div>
            </div>

            <div class="d-flex flex-wrap gap-2 align-items-center justify-content-between flash-nav-row">
              <div class="d-flex flex-wrap gap-2 align-items-center nav-inline">
                <button id="btnPrev" class="btn btn-outline-secondary btn-sm nav-btn"><i class="bi bi-chevron-left"></i></button>
                <div class="small-muted nav-counter"><span data-i18n="card_label">Card</span> <b id="cardIndex">0</b>/<b id="cardCount">0</b></div>
                <button id="btnNext" class="btn btn-outline-secondary btn-sm nav-btn"><i class="bi bi-chevron-right"></i></button>
              </div>
              <div class="d-flex flex-wrap gap-2">
                <button id="btnMarkLearning" class="btn btn-outline-warning"><i class="bi bi-book"></i> <span data-i18n="btn_learning">Learning</span></button>
                <button id="btnMarkKnown" class="btn btn-success"><i class="bi bi-check2"></i> <span data-i18n="btn_known">Known</span></button>
                <button id="btnSpeak" class="btn btn-outline-secondary"><i class="bi bi-volume-up"></i> <span data-i18n="btn_listen">Listen</span></button>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Quiz -->
      <div class="col-12 col-lg-5">
        <div class="panel p-3 h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div>
              <div class="fw-bold fs-5" data-i18n="quiz_title">Quiz</div>
              <div class="small-muted" data-i18n="quiz_subtitle">Multiple choice or type answer.</div>
            </div>
            <button id="btnNewQuestion" class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-arrow-repeat"></i> <span data-i18n="btn_new_question">New question</span>
            </button>
          </div>

          <div id="quizEmpty" class="alert alert-warning d-none mb-0" data-i18n="quiz_empty">No quiz data. Import JSON and choose a deck.</div>

          <div id="quizArea" class="d-none">
            <div class="mb-2">
              <span class="chip"><i class="bi bi-patch-question-fill text-primary"></i> <span id="quizMeta">...</span></span>
            </div>

            <div class="p-3" style="border-radius:18px;border:1px solid rgba(0,0,0,.08);background:rgba(255,255,255,.75)">
              <div class="small-muted mb-1" data-i18n="quiz_question_label">Question</div>
              <div id="quizPrompt" class="fw-bold" style="font-size:1.2rem;">...</div>
              <div id="quizHint" class="hint mt-2 d-none"></div>
            </div>

            <div class="mt-3">
              <div id="quizMC" class="d-none">
                <div class="d-grid gap-2" id="quizOptions"></div>
              </div>

              <div id="quizTypeBox" class="d-none">
                <label class="form-label fw-semibold" data-i18n="quiz_type_label">Type your answer</label>
                <input id="typeInput" class="form-control" placeholder="Type the answer and press Enter..." data-i18n-placeholder="quiz_type_placeholder">
                <div class="d-flex gap-2 mt-2">
                  <button id="btnTypeSubmit" class="btn btn-primary"><i class="bi bi-send-check"></i> <span data-i18n="btn_type_submit">Submit</span></button>
                  <button id="btnTypeShow" class="btn btn-outline-secondary"><i class="bi bi-eye"></i> <span data-i18n="btn_type_show">Show answer</span></button>
                </div>
                <div id="typeFeedback" class="mt-2"></div>
              </div>
            </div>

            <hr class="my-3">

            <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center">
              <div class="d-flex gap-2">
                <span class="stat"><i class="bi bi-bar-chart-fill text-primary"></i> <span data-i18n="score_right">Right</span>: <b id="scoreRight">0</b></span>
                <span class="stat"><i class="bi bi-x-circle-fill text-danger"></i> <span data-i18n="score_wrong">Wrong</span>: <b id="scoreWrong">0</b></span>
              </div>
              <button id="btnQuizSpeak" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-volume-up"></i> <span data-i18n="btn_quiz_speak">Speak question</span>
              </button>
            </div>
          </div>

        </div>
      </div>
    </div>

    <footer class="py-4 text-center small text-secondary" data-i18n="footer_note">
      Multi-file HTML - localStorage - Import append/create - Export backup
    </footer>
  </div>

  <!-- Modal: Import/Manage -->
  <div class="modal fade" id="dataModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content" style="border-radius: 18px;">
        <div class="modal-header">
          <div>
            <h5 class="modal-title" data-i18n="modal_title">Import / Manage decks</h5>
            <div class="small text-secondary" data-i18n="modal_desc">
              Import adds data, it does not overwrite. You can append to an existing deck or create a new one.
            </div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="row g-2 mb-3">
            <div class="col-12 col-lg-5">
              <label class="form-label fw-semibold" data-i18n="label_import_mode">Import mode</label>
              <select id="importMode" class="form-select">
                <option value="append_existing" data-i18n="import_mode_append">Append to existing deck</option>
                <option value="create_new" data-i18n="import_mode_create">Create new deck (by title)</option>
              </select>
              <div class="form-text" data-i18n="import_mode_help">Does not overwrite existing data.</div>
            </div>

            <div class="col-12 col-lg-7">
              <label class="form-label fw-semibold" data-i18n="label_import_deck">Choose deck (when appending)</label>
              <select id="importDeckSelect" class="form-select"></select>
              <div class="form-text" data-i18n="import_deck_help">Only required when appending.</div>
            </div>

            <div class="col-12 col-lg-7">
              <label class="form-label fw-semibold" data-i18n="label_new_deck_title">New deck title (when creating)</label>
              <input id="newDeckTitle" class="form-control" placeholder="e.g., Driving, Restaurant, Company..." data-i18n-placeholder="new_deck_placeholder" />
              <div class="form-text" data-i18n="new_deck_help">Only required when creating.</div>
            </div>

            <div class="col-12 col-lg-5">
              <label class="form-label fw-semibold" data-i18n="label_manage_decks">Manage decks</label>
              <button id="btnDeleteSelectedDeck" class="btn btn-outline-danger w-100" type="button">
                <i class="bi bi-trash3"></i> <span data-i18n="btn_delete_selected_deck">Delete selected deck</span>
              </button>
            </div>
          </div>

          <div class="alert alert-info">
            <b data-i18n="json_tip_title">Recommended JSON import</b> <span data-i18n="json_tip_note">(no id required)</span>:
            <pre class="mb-0 small"><code>{
  "items": [
    { "jp": "furonto garasu", "reading": "", "vi": "windshield", "tags": ["auto"] },
    { "jp": "waipa", "vi": "wiper" }
  ]
}</code></pre>
          </div>
          <div class="alert alert-secondary">
            <div class="d-flex align-items-start justify-content-between gap-2">
              <div>
                <div class="fw-semibold" data-i18n="json_ai_title">AI prompt (copy & paste)</div>
                <div class="small text-secondary" data-i18n="json_ai_desc">
                  If you want AI to generate JSON, copy the prompt below and fill in your topic/quantity. The result must be valid JSON.
                </div>
              </div>
              <button id="btnCopyAiPrompt" type="button" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-clipboard"></i> <span data-i18n="btn_copy_prompt">Copy</span>
              </button>
            </div>
            <pre class="mt-2 mb-0 small"><code id="jsonAiPrompt"></code></pre>
          </div>

          <label class="form-label fw-semibold" data-i18n="label_json">JSON</label>
          <textarea id="jsonTextarea" class="form-control" rows="12" spellcheck="false"></textarea>

          <div class="d-flex flex-wrap gap-2 mt-2">
            <button id="btnLoadSample" class="btn btn-outline-secondary btn-sm" type="button">
              <i class="bi bi-file-earmark-text"></i> <span data-i18n="btn_load_sample">Load sample</span>
            </button>
            <button id="btnPasteJSON" class="btn btn-outline-secondary btn-sm" type="button">
              <i class="bi bi-clipboard"></i> <span data-i18n="btn_paste_json">Paste</span>
            </button>
            <button id="btnClearJSON" class="btn btn-outline-danger btn-sm" type="button">
              <i class="bi bi-trash3"></i> <span data-i18n="btn_clear_json">Clear</span>
            </button>
          </div>

          <div id="jsonError" class="alert alert-danger d-none mt-3 mb-0"></div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" data-i18n="modal_close">Close</button>
          <button id="btnApplyJSON" type="button" class="btn btn-primary">
            <i class="bi bi-check2-circle"></i> <span data-i18n="btn_import_apply">Import (Add data)</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <script src="data/sample-data.js"></script>
  <script src="lang/i18n.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
